!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("immutable")):"function"==typeof define&&define.amd?define(["immutable"],t):"object"==typeof exports?exports.adease=t(require("immutable")):e.adease=t(e.immutable)}(window,function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.round=function(e){return Math.round(100*e)/100}},function(e,t,n){"use strict";var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Impression="impression",e.Clickthrough="clickthrough",e.Stream="stream",e.Fullscreen="fullscreen",e.ExitFullscreen="exitFullscreen",e.OtherAdInteraction="otherAdInteraction",e.Start="start",e.FirstQuartile="firstQuartile",e.MidPoint="midpoint",e.ThirdQuartile="thirdQuartile",e.Complete="complete",e.AcceptInvitationLinear="acceptInvitationLinear",e.TimeSpentViewing="timeSpentViewing",e.Progress="progress",e.CloseLinear="closeLinear",e.CreativeView="creativeView",e.AcceptInvitation="acceptInvitation",e.AdExpand="adExpand",e.AdCollapse="adCollapse",e.Minimize="minimize",e.Close="close",e.OverlayViewDuration="overlayViewDuration",e.Mute="mute",e.Unmute="unmute",e.Pause="pause",e.Resume="resume",e.Rewind="rewind",e.Skip="skip",e.PlayerExpand="playerExpand",e.PlayerCollapse="playerCollapse"}(r=t.EventType||(t.EventType={})),t.NonLinearEvents=[r.CreativeView,r.AcceptInvitation,r.AdExpand,r.Minimize,r.Close,r.OverlayViewDuration],t.LinearEvents=[r.Start,r.Impression,r.FirstQuartile,r.MidPoint,r.ThirdQuartile,r.Complete,r.AcceptInvitationLinear,r.TimeSpentViewing,r.Progress,r.CloseLinear],t.PlayerEvents=[r.Mute,r.Unmute,r.Pause,r.Resume,r.Rewind,r.Skip,r.PlayerExpand,r.PlayerCollapse];var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t}return i(e,[{key:"getAdBreaks",value:function(){var e=this;return this.config&&this.config.trackingURLs?this.config.trackingURLs.filter(function(e){return e.kind===r.Clickthrough}).reduce(function(t,n){if(-1!==t.findIndex(function(e){return e.startTime===n.startTime}))return t;var i=e.config.trackingURLs.filter(function(e){return e.adID===n.adID&&e.startTime>=n.startTime&&e.endTime<=n.endTime}),u={id:n.adID,startTime:n.startTime,endTime:n.endTime,trackingUrls:i,clickThroughs:i.filter(function(e){return e.kind===r.Clickthrough})};return t.concat(u)},[]):[]}},{key:"getConfig",value:function(){return this.config}},{key:"getTrackingURLs",value:function(){return this.config.trackingURLs}}],[{key:"fromJSON",value:function(t){var n=e.parseFromObject(t);if(null===n)throw new Error("error parsing configuration");return new e(n)}},{key:"parseFromObject",value:function(e){return e&&e.media&&e.media.trackingUrls?{trackingURLs:e.media.trackingUrls.map(function(e){return{url:e.url,startTime:Number(e.starttime),endTime:Number(e.endtime),kind:e.event,adID:e.adID}}),streams:e.media.renditions.map(function(e){return{url:e.url}})}:null}}]),e}();t.default=u},function(t,n){t.exports=e},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),u=n(1),o=n(0),a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sentBeacons=i.Set(),this.lastTimePosition=NaN}return r(e,[{key:"configureFromURL",value:function(e){var t=this;return this.reset(),fetch(e).then(function(e){return e.json()}).then(u.default.fromJSON).then(function(e){return t.config=e}).then(function(){})}},{key:"configureFromObject",value:function(e){this.reset(),this.config=u.default.fromJSON(e)}},{key:"getStreams",value:function(){return this.ensureSetup(),this.config.getConfig().streams}},{key:"notifyTimeUpdate",value:function(e){var t=this;return this.ensureSetup(),NaN===this.lastTimePosition&&(this.lastTimePosition=0),this.sendBeacons(e).then(function(){return t.lastTimePosition=e}).then(function(){})}},{key:"getStreamTime",value:function(e){this.ensureSetup();var t=this.getAds().sort(function(e,t){return e.startTime<t.startTime?-1:e.startTime>t.startTime?1:0}),n=e,r=!0,i=!1,u=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;n>=c.startTime&&(n+=c.endTime)}}catch(e){i=!0,u=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw u}}return o.round(n)}},{key:"getAds",value:function(){return this.ensureSetup(),this.config.getAdBreaks()}},{key:"getAdsAtTime",value:function(e){return this.ensureSetup(),this.config.getAdBreaks().filter(function(t){return t.startTime<=e&&t.endTime>=e})}},{key:"getAssetTime",value:function(e){this.ensureSetup();var t=function(e,t){return e+t},n=this.config.getAdBreaks().filter(function(t){return t.startTime<e}),r=n.filter(function(t){return t.endTime<=e}).map(function(e){return e.endTime-e.startTime}).reduce(t,0),i=n.filter(function(t){return t.endTime>e}).map(function(t){return e-t.startTime}).reduce(t,0);return o.round(e-(r+i))}},{key:"sendBeacons",value:function(e){var t=this,n=this.getBeaconsForRange(this.lastTimePosition,e).filter(function(e){return u.LinearEvents.includes(e.kind)}).filter(function(n){return n.startTime<e&&n.startTime>t.lastTimePosition}).map(function(e){return t.sentBeacons.includes(e)?Promise.resolve():(t.sentBeacons=t.sentBeacons.add(e),fetch(e.url,{mode:"no-cors"}).then(function(){}))});return Promise.all(n).then(function(){})}},{key:"getBeaconsForRange",value:function(e,t){return this.config.getTrackingURLs().filter(function(n){return n.startTime<=t&&n.endTime>=e})}},{key:"ensureSetup",value:function(){if(!this.config)throw new Error("Adease not setup, but method called")}},{key:"reset",value:function(){this.sentBeacons=this.sentBeacons.clear()}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3);t.Adease=r.default}])});
//# sourceMappingURL=index.js.map