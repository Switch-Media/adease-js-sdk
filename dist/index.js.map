{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 1347a9ed60d4a314b696","webpack:///./src/index.ts","webpack:///./src/Adease.ts","webpack:///./src/Configuration.ts"],"names":["Object","defineProperty","exports","value","Adease_1","require","Adease","default","Configuration_1","sentBeacons","url","fetch","then","res","json","fromJSON","config","undefined","ensureSetup","getConfig","streams","time","sendBeacons","ps","getAdsForTime","map","ad","trackingUrls","filter","tURL","kind","startTime","includes","Promise","resolve","push","all","getAdBreaks","endTime","Configuration","trackingURLs","reduce","ads","findIndex","t","adID","id","concat","parsedConfiguration","parseFromObject","media","obj","Number","starttime","endtime","event","renditions"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;AC7DA;;AACAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA,IAAMC,WAAW,mBAAAC,CAAQ,CAAR,CAAjB;AACAH,QAAQI,MAAR,GAAiBF,SAASG,OAA1B,C;;;;;;;ACHA;;;;;;AACAP,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA,IAAMK,kBAAkB,mBAAAH,CAAQ,CAAR,CAAxB;;IACMC,M;AACF,sBAAc;AAAA;;AACV,aAAKG,WAAL,GAAmB,EAAnB;AACH;AACD;;;;;;;;;;yCAMiBC,G,EAAK;AAAA;;AAClB,mBAAOC,MAAMD,GAAN,EACFE,IADE,CACG;AAAA,uBAAOC,IAAIC,IAAJ,EAAP;AAAA,aADH,EAEFF,IAFE,CAEGJ,gBAAgBD,OAAhB,CAAwBQ,QAF3B,EAGFH,IAHE,CAGG;AAAA,uBAAW,MAAKI,MAAL,GAAcA,MAAzB;AAAA,aAHH,EAIFJ,IAJE,CAIG;AAAA,uBAAMK,SAAN;AAAA,aAJH,CAAP;AAKH;;;qCACY;AACT,iBAAKC,WAAL;AACA,mBAAO,KAAKF,MAAL,CAAYG,SAAZ,GAAwBC,OAA/B;AACH;AACD;;;;;;;yCAIiBC,I,EAAM;AACnB,iBAAKH,WAAL;AACA,mBAAO,KAAKI,WAAL,CAAiBD,IAAjB,CAAP;AACH;AACD;;;;;;oCAGYA,I,EAAM;AAAA;;AACd,gBAAME,KAAK,KAAKC,aAAL,CAAmBH,IAAnB,EACNI,GADM,CACF,cAAM;AACX,uBAAOC,GAAGC,YAAH,CACFC,MADE,CACK;AAAA,2BAAQC,KAAKC,IAAL,KAAc,YAAtB;AAAA,iBADL,EAEFF,MAFE,CAEK;AAAA,2BAAQC,KAAKE,SAAL,GAAiBV,IAAzB;AAAA,iBAFL,EAGFI,GAHE,CAGE,gBAAQ;AACb,wBAAI,OAAKhB,WAAL,CAAiBuB,QAAjB,CAA0BH,IAA1B,CAAJ,EAAqC;AACjC,+BAAOI,QAAQC,OAAR,EAAP;AACH;AACD,2BAAKzB,WAAL,CAAiB0B,IAAjB,CAAsBN,IAAtB;AACA,2BAAOlB,MAAMkB,KAAKnB,GAAX,CAAP;AACH,iBATM,CAAP;AAUH,aAZU,CAAX;AAaA,mBAAOuB,QAAQG,GAAR,CAAYb,EAAZ,EAAgBX,IAAhB,CAAqB;AAAA,uBAAMK,SAAN;AAAA,aAArB,CAAP;AACH;;;sCACaI,I,EAAM;AAChB,mBAAO,KAAKL,MAAL,CAAYqB,WAAZ,GAA0BT,MAA1B,CAAiC;AAAA,uBAAMF,GAAGK,SAAH,IAAgBV,IAAhB,IAAwBK,GAAGY,OAAH,IAAcjB,IAA5C;AAAA,aAAjC,CAAP;AACH;;;sCACa;AACV,gBAAI,CAAC,KAAKL,MAAV,EAAkB;AACd,sBAAM,qCAAN;AACH;AACJ;;;;;;AAELd,QAAQK,OAAR,GAAkBD,MAAlB,C;;;;;;;AC5DA;;;;;;AACAN,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA;;;;IAGMoC,a;AACF,2BAAYvB,MAAZ,EAAoB;AAAA;;AAChB,aAAKA,MAAL,GAAcA,MAAd;AACH;;;;sCAyBa;AAAA;;AACV,gBAAI,CAAC,KAAKA,MAAN,IAAgB,CAAC,KAAKA,MAAL,CAAYwB,YAAjC,EAA+C;AAC3C,uBAAO,EAAP;AACH;AACD,mBAAO,KAAKxB,MAAL,CAAYwB,YAAZ,CACFZ,MADE,CACK;AAAA,uBAAQC,KAAKC,IAAL,KAAc,cAAtB;AAAA,aADL,EAEFW,MAFE,CAEK,UAACC,GAAD,EAAMb,IAAN,EAAe;AACvB;AACA,oBAAIa,IAAIC,SAAJ,CAAc;AAAA,2BAAMjB,GAAGK,SAAH,KAAiBF,KAAKE,SAA5B;AAAA,iBAAd,MAAyD,CAAC,CAA9D,EAAiE;AAC7D,2BAAOW,GAAP;AACH;AACD;AACA,oBAAMF,eAAe,MAAKxB,MAAL,CAAYwB,YAAZ,CAChBZ,MADgB,CACT;AAAA,2BAAKgB,EAAEC,IAAF,KAAWhB,KAAKgB,IAAhB,IACVD,EAAEb,SAAF,IAAeF,KAAKE,SADV,IAEVa,EAAEN,OAAF,IAAaT,KAAKS,OAFb;AAAA,iBADS,CAArB;AAIA,oBAAMZ,KAAK;AACPoB,wBAAIjB,KAAKgB,IADF;AAEPd,+BAAWF,KAAKE,SAFT;AAGPO,6BAAST,KAAKS,OAHP;AAIPX,kCAAca;AAJP,iBAAX;AAMA,uBAAOE,IAAIK,MAAJ,CAAWrB,EAAX,CAAP;AACH,aAnBM,EAmBJ,EAnBI,CAAP;AAoBH;;;oCACW;AACR,mBAAO,KAAKV,MAAZ;AACH;;;0CACiB;AACd,mBAAO,KAAKA,MAAL,CAAYwB,YAAnB;AACH;;;iCAtDexB,M,EAAQ;AACpB,gBAAMgC,sBAAsBT,cAAcU,eAAd,CAA8BjC,MAA9B,CAA5B;AACA,gBAAIgC,wBAAwB,IAA5B,EAAkC;AAC9B,sBAAM,6BAAN;AACH;AACD,mBAAO,IAAIT,aAAJ,CAAkBS,mBAAlB,CAAP;AACH;;;wCACsBlC,I,EAAM;AACzB,gBAAI,EAAEA,QAAQA,KAAKoC,KAAb,IAAsBpC,KAAKoC,KAAL,CAAWvB,YAAnC,CAAJ,EAAsD;AAClD,uBAAO,IAAP;AACH;AACD,mBAAO;AACHa,8BAAc1B,KAAKoC,KAAL,CAAWvB,YAAX,CAAwBF,GAAxB,CAA4B;AAAA,2BAAQ;AAC9Cf,6BAAKyC,IAAIzC,GADqC;AAE9CqB,mCAAWqB,OAAOD,IAAIE,SAAX,CAFmC;AAG9Cf,iCAASc,OAAOD,IAAIG,OAAX,CAHqC;AAI9CxB,8BAAMqB,IAAII,KAJoC;AAK9CV,8BAAMM,IAAIN;AALoC,qBAAR;AAAA,iBAA5B,CADX;AAQHzB,yBAASN,KAAKoC,KAAL,CAAWM,UAAX,CAAsB/B,GAAtB,CAA0B;AAAA,2BAAQ;AACvCf,6BAAKyC,IAAIzC;AAD8B,qBAAR;AAAA,iBAA1B;AARN,aAAP;AAYH;;;;;;AAiCLR,QAAQK,OAAR,GAAkBgC,aAAlB,C","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"adease\"] = factory();\n\telse\n\t\troot[\"adease\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1347a9ed60d4a314b696","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Adease_1 = require(\"./Adease\");\nexports.Adease = Adease_1.default;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.ts","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Configuration_1 = require(\"./Configuration\");\nclass Adease {\n    constructor() {\n        this.sentBeacons = [];\n    }\n    /**\n     * Downloads adease configuration from a URL, returning a promise\n     * that resolves with undefined when done.\n     * @param url string\n     * @return Promise<void>\n     */\n    configureFromURL(url) {\n        return fetch(url)\n            .then(res => res.json())\n            .then(Configuration_1.default.fromJSON)\n            .then(config => (this.config = config))\n            .then(() => undefined);\n    }\n    getStreams() {\n        this.ensureSetup();\n        return this.config.getConfig().streams;\n    }\n    /**\n     * Notify adease that a time update has occured. This may fire off beacons.\n     * Returns a promise that resolves once all underlying actions have completed.\n     */\n    notifyTimeUpdate(time) {\n        this.ensureSetup();\n        return this.sendBeacons(time);\n    }\n    /**\n     * @return A promise that resolves once all beacons are sent.\n     */\n    sendBeacons(time) {\n        const ps = this.getAdsForTime(time)\n            .map(ad => {\n            return ad.trackingUrls\n                .filter(tURL => tURL.kind === \"impression\")\n                .filter(tURL => tURL.startTime < time)\n                .map(tURL => {\n                if (this.sentBeacons.includes(tURL)) {\n                    return Promise.resolve();\n                }\n                this.sentBeacons.push(tURL);\n                return fetch(tURL.url);\n            });\n        });\n        return Promise.all(ps).then(() => undefined);\n    }\n    getAdsForTime(time) {\n        return this.config.getAdBreaks().filter(ad => ad.startTime <= time && ad.endTime >= time);\n    }\n    ensureSetup() {\n        if (!this.config) {\n            throw \"Adease not setup, but method called\";\n        }\n    }\n}\nexports.default = Adease;\n\n\n\n// WEBPACK FOOTER //\n// ./src/Adease.ts","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * @internal\n */\nclass Configuration {\n    constructor(config) {\n        this.config = config;\n    }\n    static fromJSON(config) {\n        const parsedConfiguration = Configuration.parseFromObject(config);\n        if (parsedConfiguration === null) {\n            throw \"error parsing configuration\";\n        }\n        return new Configuration(parsedConfiguration);\n    }\n    static parseFromObject(json) {\n        if (!(json && json.media && json.media.trackingUrls)) {\n            return null;\n        }\n        return {\n            trackingURLs: json.media.trackingUrls.map(obj => ({\n                url: obj.url,\n                startTime: Number(obj.starttime),\n                endTime: Number(obj.endtime),\n                kind: obj.event,\n                adID: obj.adID,\n            })),\n            streams: json.media.renditions.map(obj => ({\n                url: obj.url,\n            })),\n        };\n    }\n    getAdBreaks() {\n        if (!this.config || !this.config.trackingURLs) {\n            return [];\n        }\n        return this.config.trackingURLs\n            .filter(tURL => tURL.kind === 'clickthrough')\n            .reduce((ads, tURL) => {\n            // Try to find an existing ad with this start time.\n            if (ads.findIndex(ad => ad.startTime === tURL.startTime) !== -1) {\n                return ads;\n            }\n            // Get the tracking URLs for this ad.\n            const trackingURLs = this.config.trackingURLs\n                .filter(t => t.adID === tURL.adID\n                && t.startTime >= tURL.startTime\n                && t.endTime <= tURL.endTime);\n            const ad = {\n                id: tURL.adID,\n                startTime: tURL.startTime,\n                endTime: tURL.endTime,\n                trackingUrls: trackingURLs,\n            };\n            return ads.concat(ad);\n        }, []);\n    }\n    getConfig() {\n        return this.config;\n    }\n    getTrackingURLs() {\n        return this.config.trackingURLs;\n    }\n}\nexports.default = Configuration;\n\n\n\n// WEBPACK FOOTER //\n// ./src/Configuration.ts"],"sourceRoot":""}