{"version":3,"sources":["webpack://adease/webpack/universalModuleDefinition","webpack://adease/webpack/bootstrap","webpack://adease/./src/Util.ts","webpack://adease/./src/Configuration.ts","webpack://adease/external \"immutable\"","webpack://adease/./src/Adease.ts","webpack://adease/./src/index.ts"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__2__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","round","Math","EventType","NonLinearEvents","CreativeView","AcceptInvitation","AdExpand","Minimize","Close","OverlayViewDuration","LinearEvents","Start","Impression","FirstQuartile","MidPoint","ThirdQuartile","Complete","AcceptInvitationLinear","TimeSpentViewing","Progress","CloseLinear","PlayerEvents","Mute","Unmute","Pause","Resume","Rewind","Skip","PlayerExpand","PlayerCollapse","Configuration","config","_classCallCheck","this","_this","trackingURLs","filter","tURL","kind","Clickthrough","reduce","ads","findIndex","ad","startTime","t","adID","endTime","id","trackingUrls","clickThroughs","concat","parsedConfiguration","parseFromObject","Error","json","media","map","obj","url","Number","starttime","endtime","event","streams","renditions","default","immutable_1","Configuration_1","Util_1","Adease","sentBeacons","Set","lastTimePosition","NaN","reset","fetch","then","res","fromJSON","_","ensureSetup","getConfig","timeMs","_this2","sendBeacons","assetTimeMs","getAds","sort","a","b","position","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","err","return","getAdBreaks","streamTimeMs","add","allAds","previousAdsDuration","inProgressAdsDuration","time","_this3","ps","getBeaconsForRange","includes","Promise","resolve","mode","all","start","end","getTrackingURLs","clear","Adease_1"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"immutable\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"immutable\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"adease\"] = factory(require(\"immutable\"));\n\telse\n\t\troot[\"adease\"] = factory(root[\"immutable\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__2__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Rounds to two decimal places.\n * @param n number to round\n */\nfunction round(n) {\n    return Math.round(n * 100) / 100;\n}\nexports.round = round;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar EventType;\n(function (EventType) {\n    // Basic metrics\n    EventType[\"Impression\"] = \"impression\";\n    EventType[\"Clickthrough\"] = \"clickthrough\";\n    EventType[\"Stream\"] = \"stream\";\n    EventType[\"Fullscreen\"] = \"fullscreen\";\n    EventType[\"ExitFullscreen\"] = \"exitFullscreen\";\n    EventType[\"OtherAdInteraction\"] = \"otherAdInteraction\";\n    // Linear Ad Metrics\n    EventType[\"Start\"] = \"start\";\n    EventType[\"FirstQuartile\"] = \"firstQuartile\";\n    EventType[\"MidPoint\"] = \"midpoint\";\n    EventType[\"ThirdQuartile\"] = \"thirdQuartile\";\n    EventType[\"Complete\"] = \"complete\";\n    EventType[\"AcceptInvitationLinear\"] = \"acceptInvitationLinear\";\n    EventType[\"TimeSpentViewing\"] = \"timeSpentViewing\";\n    EventType[\"Progress\"] = \"progress\";\n    EventType[\"CloseLinear\"] = \"closeLinear\";\n    // Nonlinear Ad Metrics\n    EventType[\"CreativeView\"] = \"creativeView\";\n    EventType[\"AcceptInvitation\"] = \"acceptInvitation\";\n    EventType[\"AdExpand\"] = \"adExpand\";\n    EventType[\"AdCollapse\"] = \"adCollapse\";\n    EventType[\"Minimize\"] = \"minimize\";\n    EventType[\"Close\"] = \"close\";\n    EventType[\"OverlayViewDuration\"] = \"overlayViewDuration\";\n    // Player Operation Metrics (for both Linear and Nonlinear ads)\n    EventType[\"Mute\"] = \"mute\";\n    EventType[\"Unmute\"] = \"unmute\";\n    EventType[\"Pause\"] = \"pause\";\n    EventType[\"Resume\"] = \"resume\";\n    EventType[\"Rewind\"] = \"rewind\";\n    EventType[\"Skip\"] = \"skip\";\n    EventType[\"PlayerExpand\"] = \"playerExpand\";\n    EventType[\"PlayerCollapse\"] = \"playerCollapse\";\n})(EventType = exports.EventType || (exports.EventType = {}));\nexports.NonLinearEvents = [\n    EventType.CreativeView,\n    EventType.AcceptInvitation,\n    EventType.AdExpand,\n    EventType.Minimize,\n    EventType.Close,\n    EventType.OverlayViewDuration\n];\nexports.LinearEvents = [\n    EventType.Start,\n    EventType.Impression,\n    EventType.FirstQuartile,\n    EventType.MidPoint,\n    EventType.ThirdQuartile,\n    EventType.Complete,\n    EventType.AcceptInvitationLinear,\n    EventType.TimeSpentViewing,\n    EventType.Progress,\n    EventType.CloseLinear\n];\nexports.PlayerEvents = [\n    EventType.Mute,\n    EventType.Unmute,\n    EventType.Pause,\n    EventType.Resume,\n    EventType.Rewind,\n    EventType.Skip,\n    EventType.PlayerExpand,\n    EventType.PlayerCollapse\n];\n/**\n * @internal\n */\nclass Configuration {\n    constructor(config) {\n        this.config = config;\n    }\n    static fromJSON(config) {\n        const parsedConfiguration = Configuration.parseFromObject(config);\n        if (parsedConfiguration === null) {\n            throw new Error(\"error parsing configuration\");\n        }\n        return new Configuration(parsedConfiguration);\n    }\n    static parseFromObject(json) {\n        if (!(json && json.media && json.media.trackingUrls)) {\n            return null;\n        }\n        return {\n            trackingURLs: json.media.trackingUrls.map(obj => ({\n                url: obj.url,\n                startTime: Number(obj.starttime),\n                endTime: Number(obj.endtime),\n                kind: obj.event,\n                adID: obj.adID\n            })),\n            streams: json.media.renditions.map(obj => ({\n                url: obj.url\n            }))\n        };\n    }\n    getAdBreaks() {\n        if (!this.config || !this.config.trackingURLs) {\n            return [];\n        }\n        return this.config.trackingURLs\n            .filter(tURL => tURL.kind === EventType.Clickthrough)\n            .reduce((ads, tURL) => {\n            // Try to find an existing ad with this start time.\n            if (ads.findIndex(ad => ad.startTime === tURL.startTime) !== -1) {\n                return ads;\n            }\n            // Get the tracking URLs for this ad.\n            const trackingURLs = this.config.trackingURLs.filter(t => t.adID === tURL.adID &&\n                t.startTime >= tURL.startTime &&\n                t.endTime <= tURL.endTime);\n            const ad = {\n                id: tURL.adID,\n                startTime: tURL.startTime,\n                endTime: tURL.endTime,\n                trackingUrls: trackingURLs,\n                clickThroughs: trackingURLs.filter(tURL => tURL.kind === EventType.Clickthrough),\n            };\n            return ads.concat(ad);\n        }, []);\n    }\n    getConfig() {\n        return this.config;\n    }\n    getTrackingURLs() {\n        return this.config.trackingURLs;\n    }\n}\nexports.default = Configuration;\n","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst immutable_1 = require(\"immutable\");\nconst Configuration_1 = require(\"./Configuration\");\nconst Util_1 = require(\"./Util\");\n/**\n * The adease class essentially provides a wrapper around a configuration object.\n * The configuration object contains all of the information regarding where in a stream\n * the ads have been inserted.\n *\n * This class has methods both to query what ads have been inserted where, as well\n * as triggering analytics based on time updates and user initiated actions.\n *\n * Internal state is kept to track what beacons have been sent, and what the last time\n * update was. Whenever configuration is provided this internal state is reset.\n * If this internal state needs to be preserved, then a new instance should be created\n * instead.\n *\n * *NOTE:* All methods except `configureFromURL` and `configureFromObject` will\n * throw an exception if the class has not been provided configuration.  Your\n * code should ensure that the class has been setup before calling any methods;\n * a proxy pattern can work well here. This design choice has been made\n * to avoid silently failing, to increase development/debugging speed.\n */\nclass Adease {\n    constructor() {\n        this.sentBeacons = immutable_1.Set();\n        this.lastTimePosition = NaN;\n    }\n    /**\n     * Downloads adease configuration from a URL, returning a promise\n     * that resolves with undefined when done.\n     * @param url string\n     * @return Promise<void>\n     */\n    configureFromURL(url) {\n        this.reset();\n        return fetch(url)\n            .then(res => res.json())\n            .then(Configuration_1.default.fromJSON)\n            .then(_ => (this.config = _))\n            .then(() => undefined);\n    }\n    /**\n     * Configures the class from an object.\n     * @param url string\n     * @return Promise<void>\n     */\n    configureFromObject(object) {\n        this.reset();\n        this.config = Configuration_1.default.fromJSON(object);\n    }\n    getStreams() {\n        this.ensureSetup();\n        return this.config.getConfig().streams;\n    }\n    /**\n     * Notify that a time update (position in the stream) has occured. This may fire off beacons.\n     * Returns a promise that resolves once all underlying network requests have completed.\n     *\n     * @param timeMs number Time in milliseconds.\n     */\n    notifyTimeUpdate(timeMs) {\n        this.ensureSetup();\n        if (this.lastTimePosition === NaN) {\n            this.lastTimePosition = 0;\n        }\n        return this.sendBeacons(timeMs)\n            .then(() => (this.lastTimePosition = timeMs))\n            .then(() => undefined);\n    }\n    /**\n     * Since inserting ads into a stream changes the duration, it can be useful to translate\n     * between the original time of the asset and the corresponding time in the loaded stream.\n     * This method returns the time in the stream that a position in the original asset corresponds to.\n     *\n     * For example, 5 seconds into the original asset would be 35 seconds in the loaded stream\n     * if a 30 second pre roll has been inserted.\n     *\n     * @param assetTimeMs Returns the real stream time.\n     */\n    getStreamTime(assetTimeMs) {\n        this.ensureSetup();\n        // Calculate the true start times of each ad.\n        const ads = this.getAds().sort((a, b) => {\n            if (a.startTime < b.startTime) {\n                return -1;\n            }\n            if (a.startTime > b.startTime) {\n                return 1;\n            }\n            return 0;\n        });\n        let position = assetTimeMs;\n        for (const ad of ads) {\n            // Position is in the middle of an ad. Move to end.\n            if (position >= ad.startTime) {\n                position += ad.endTime;\n            }\n        }\n        return Util_1.round(position);\n    }\n    /**\n     * Returns the ads.\n     */\n    getAds() {\n        this.ensureSetup();\n        return this.config.getAdBreaks();\n    }\n    /**\n     * Returns the ads that are present at a given moment. In practice this\n     * will only ever return either an empty list, or a list with one element.\n     * It is theoretically possible for more than one ad to be returned,\n     * however this makes no practical sense.\n     *\n     * @param timeMs Time in milliseconds.\n     */\n    getAdsAtTime(timeMs) {\n        this.ensureSetup();\n        return this.config.getAdBreaks().filter(ad => ad.startTime <= timeMs && ad.endTime >= timeMs);\n    }\n    /**\n     * This is the inverse of `getStreamTime`. It returns the time in an asset\n     * that the loaded stream time corresponds to. For example, if the time 35 seconds is\n     * given, then 5 seconds will be returned if a 30 second pre roll has been inserted.\n     *\n     * @param streamTimeMs number Time in milliseconds.\n     * @returns number Time in milliseconds.\n     */\n    getAssetTime(streamTimeMs) {\n        this.ensureSetup();\n        const add = (a, b) => a + b;\n        // Find the ads before the given time.\n        const allAds = this.config\n            .getAdBreaks()\n            .filter(ad => ad.startTime < streamTimeMs);\n        const previousAdsDuration = allAds\n            .filter(ad => ad.endTime <= streamTimeMs)\n            .map(ad => ad.endTime - ad.startTime)\n            .reduce(add, 0);\n        const inProgressAdsDuration = allAds\n            .filter(ad => ad.endTime > streamTimeMs)\n            .map(ad => streamTimeMs - ad.startTime)\n            .reduce(add, 0);\n        return Util_1.round(streamTimeMs - (previousAdsDuration + inProgressAdsDuration));\n    }\n    /**\n     * @return A promise that resolves once all beacons are sent.\n     */\n    sendBeacons(time) {\n        const ps = this.getBeaconsForRange(this.lastTimePosition, time)\n            .filter(tURL => Configuration_1.LinearEvents.includes(tURL.kind))\n            .filter(tURL => tURL.startTime < time && tURL.startTime > this.lastTimePosition)\n            .map(tURL => {\n            if (this.sentBeacons.includes(tURL)) {\n                return Promise.resolve();\n            }\n            this.sentBeacons = this.sentBeacons.add(tURL);\n            return fetch(tURL.url, {\n                mode: \"no-cors\"\n            }).then(() => undefined);\n        });\n        return Promise.all(ps).then(() => undefined);\n    }\n    getBeaconsForRange(start, end) {\n        return this.config\n            .getTrackingURLs()\n            .filter(tURL => tURL.startTime <= end && tURL.endTime >= start);\n    }\n    ensureSetup() {\n        if (!this.config) {\n            throw new Error(\"Adease not setup, but method called\");\n        }\n    }\n    /**\n     * Resets the internal state of the object so that it can be reused.\n     */\n    reset() {\n        this.sentBeacons = this.sentBeacons.clear();\n    }\n}\nexports.default = Adease;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Adease_1 = require(\"./Adease\");\nexports.Adease = Adease_1.default;\n"],"sourceRoot":""}